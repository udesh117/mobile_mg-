# Assignee Explanation - How It Works

## ğŸ“‹ What is an Assignee?

An **assignee** is a project member who is assigned to work on a specific task. It's a way to track who is responsible for completing each task.

---

## ğŸ”‘ Key Concepts

### 1. **Assignee ID (`assigneeId`)**
- Stored in the `Task` object
- It's a **Firebase Auth User ID** (`user.uid`)
- Optional field - tasks can be unassigned
- Type: `string | undefined`

### 2. **Project Members**
- People who have access to a project
- Stored in `projectMembers` collection in Firestore
- Each member has:
  - `userId`: Firebase Auth User ID
  - `projectId`: The project they belong to
  - `role`: Either `'owner'` or `'member'`

### 3. **User ID (`userId`)**
- Generated by **Firebase Authentication**
- Unique identifier for each user
- Format: Long alphanumeric string (e.g., `abc123xyz456...`)
- Created when user signs up

---

## ğŸ”„ How Assignees Are Generated

### Step 1: User Signs Up
```
User signs up â†’ Firebase Auth creates account â†’ Generates unique userId
Example: userId = "a1b2c3d4e5f6g7h8i9j0"
```

### Step 2: Project Creation
When a project is created, the **project owner is automatically added as a project member**:

```typescript
// In useCreateProject() hook
const docRef = await addDoc(collection(db, 'projects'), projectData);

// Automatically add owner as project member
const memberId = `${docRef.id}_${user.uid}`;
await setDoc(doc(db, 'projectMembers', memberId), {
  projectId: docRef.id,
  userId: user.uid,  // â† This is the Firebase Auth UID
  role: 'owner',
  createdAt: serverTimestamp(),
});
```

**Result:**
- Project owner becomes a project member
- Their `userId` is stored in `projectMembers` collection
- They can be assigned to tasks

### Step 3: Task Assignment
When creating or editing a task, you can select an assignee from the project members:

```typescript
// In CreateTaskModal or EditTaskModal
const { data: members } = useProjectMembers(projectId);

// Dropdown shows all project members
{members?.map((member) => (
  <Menu.Item
    onPress={() => {
      setAssigneeId(member.userId);  // â† Assignee ID = Member's User ID
    }}
    title={member.userId.substring(0, 8)}  // Show first 8 chars
  />
))}
```

**Result:**
- Selected member's `userId` is stored as `assigneeId` in the task
- Task is now assigned to that user

---

## ğŸ“Š Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Signs Up  â”‚
â”‚  (Firebase Auth)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  userId Created â”‚
â”‚  (e.g., a1b2...)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Create Project  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Owner Added as Member    â”‚
â”‚ projectMembers: {       â”‚
â”‚   userId: "a1b2...",    â”‚
â”‚   role: "owner"         â”‚
â”‚ }                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Create Task     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Select Assignee          â”‚
â”‚ (from project members)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Task Created: {         â”‚
â”‚   assigneeId: "a1b2..." â”‚ â† Same as member's userId
â”‚ }                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Database Structure

### Firestore Collections

#### 1. `projects` Collection
```javascript
{
  id: "project123",
  name: "My Project",
  ownerId: "a1b2c3d4...",  // Firebase Auth UID
  createdAt: Timestamp
}
```

#### 2. `projectMembers` Collection
```javascript
{
  id: "project123_a1b2c3d4...",  // Format: projectId_userId
  projectId: "project123",
  userId: "a1b2c3d4...",  // Firebase Auth UID
  role: "owner" | "member",
  createdAt: Timestamp
}
```

#### 3. `tasks` Collection
```javascript
{
  id: "task456",
  projectId: "project123",
  title: "Complete feature",
  assigneeId: "a1b2c3d4...",  // â† Firebase Auth UID (optional)
  status: "todo",
  // ... other fields
}
```

---

## ğŸ¯ Current Implementation

### What Works:
âœ… **Project owner automatically becomes a member**
- When you create a project, you're automatically added as a project member
- You can assign tasks to yourself

âœ… **Assignee selection in task modals**
- Create Task Modal: Dropdown to select assignee
- Edit Task Modal: Dropdown to change assignee
- Shows first 8 characters of userId

âœ… **Assignee display**
- Task cards show "Assigned" if task has assignee
- Analytics shows tasks by assignee

### What's Missing (Not Required):
â­ï¸ **Add other members to project**
- Hooks exist (`useAddProjectMember`) but no UI
- Currently only project owner can be assigned
- Would need UI to invite/add other users

â­ï¸ **User display names**
- Currently shows userId (first 8 chars)
- Could show email or display name instead

---

## ğŸ” Code Examples

### Getting Project Members
```typescript
// In CreateTaskModal.tsx
const { data: members } = useProjectMembers(projectId);

// members = [
//   {
//     id: "project123_a1b2c3d4",
//     projectId: "project123",
//     userId: "a1b2c3d4e5f6g7h8",  // â† Firebase Auth UID
//     role: "owner"
//   }
// ]
```

### Selecting Assignee
```typescript
// When user selects a member from dropdown
setAssigneeId(member.userId);  // Store the userId as assigneeId

// When creating task
const taskData = {
  projectId: "project123",
  title: "My Task",
  assigneeId: "a1b2c3d4e5f6g7h8",  // â† Stored in task
  // ...
};
```

### Displaying Assignee
```typescript
// In TaskCard.tsx
{task.assigneeId ? (
  <View>
    <Avatar.Text 
      label={task.assigneeId.charAt(0).toUpperCase()} 
    />
    <Text>Assigned</Text>
  </View>
) : null}
```

### Analytics by Assignee
```typescript
// In useAnalytics.ts
tasks.forEach((task) => {
  if (task.assigneeId) {
    assigneeMap.set(task.assigneeId, (assigneeMap.get(task.assigneeId) || 0) + 1);
  }
});

// Result: Count of tasks per assigneeId
```

---

## ğŸ“ Summary

### What is `assigneeId`?
- **Firebase Auth User ID** (`user.uid`)
- Unique identifier for the user assigned to the task
- Optional - tasks can be unassigned

### How is it generated?
1. **User signs up** â†’ Firebase Auth generates `userId`
2. **Project created** â†’ Owner's `userId` added to `projectMembers`
3. **Task created** â†’ Select member from dropdown â†’ Their `userId` becomes `assigneeId`

### Where is it stored?
- **In Task**: `task.assigneeId` (optional field)
- **In ProjectMember**: `member.userId` (required field)
- **In Firestore**: As string in `tasks` and `projectMembers` collections

### How is it displayed?
- **In Task Card**: Shows "Assigned" with avatar
- **In Task Modal**: Shows first 8 characters of userId
- **In Analytics**: Counts tasks per assigneeId

---

## ğŸš€ Future Enhancements (Optional)

If you want to improve assignee functionality:

1. **Add User Display Names**
   - Store user email/name in a `users` collection
   - Show names instead of userId

2. **Add Members to Project**
   - Create UI to invite/add other users
   - Use `useAddProjectMember()` hook

3. **Better Assignee Display**
   - Show full email or name
   - Add user avatars with initials

4. **Assignee Notifications**
   - Notify assignee when task is assigned
   - Notify when task status changes

---

## âœ… Current Status

**Assignee functionality is fully implemented and working:**
- âœ… Tasks can be assigned to project members
- âœ… Project owner is automatically a member
- âœ… Assignee selection works in create/edit modals
- âœ… Assignee displayed on task cards
- âœ… Analytics tracks tasks by assignee
- âœ… Real-time sync works for assignee changes

**The only limitation:**
- Currently only project owner can be assigned (no UI to add other members)
- This is **not a requirement** - the feature works as designed!

---

**Your assignee system is working correctly!** ğŸ‰

